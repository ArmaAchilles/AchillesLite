Achillite_fnc_registerCustomModule={};Achillite_fnc_showChooseDialog={};Achillite_fnc_test={BLACKLIST_WEAPONS=["FakeHorn","AmbulanceHorn","TruckHorn","CarHorn","SportCarHorn","BikeHorn","TruckHorn2","TruckHorn3","SmokeLauncher"];params[["_unit",objNull,[objNull]]];private _weaponsToFire=[];if(_unit isKindOf"Man")then{private _weapon=primaryWeapon _unit;private _availableMagazines=magazines _unit;if!(_weapon isEqualTo"")then{private _muzzleArray=[];{private _muzzle=_x;if(_muzzle!="SAFE")then{private _magazines=[];if(_muzzle=="this")then{_magazines=getArray(configFile>>"CfgWeapons">>_weapon>>"magazines")arrayIntersect _availableMagazines}else{_magazines=getArray(configFile>>"CfgWeapons">>_weapon>>_muzzle>>"magazines")arrayIntersect _availableMagazines};_magazines=_magazines select{(toLower getText(configFile>>"CfgMagazines">>_x>>"displayName")find"smoke")isEqualTo-1};if!(_magazines isEqualTo[])then{_muzzleArray pushBack[_muzzle,_magazines]}}}forEach getArray(configFile>>"CfgWeapons">>_weapon>>"muzzles");if!(_muzzleArray isEqualTo[])then{_weaponsToFire pushBack[_weapon,_muzzleArray]}}}else{private _turrets=[[-1]]+(allTurrets _unit);{private _turretPath=_x;private _availableMagazines=_unit magazinesTurret _turretPath;if(not isNull(_unit turretUnit _turretPath))then{private _weaponArray=[];{private _weapon=_x;if!(_weapon isEqualTo""||_weapon in BLACKLIST_WEAPONS)then{private _muzzleArray=[];{private _muzzle=_x;private _magazines=[];if(_muzzle=="this")then{_magazines=getArray(configFile>>"CfgWeapons">>_weapon>>"magazines")arrayIntersect _availableMagazines}else{_magazines=getArray(configFile>>"CfgWeapons">>_weapon>>_muzzle>>"magazines")arrayIntersect _availableMagazines};if!(_magazines isEqualTo[])then{_muzzleArray pushBack[_muzzle,_magazines]}}forEach getArray(configFile>>"CfgWeapons">>_weapon>>"muzzles");if!(_muzzleArray isEqualTo[])then{_weaponsToFire pushBack[[_weapon,_turretPath],_muzzleArray]}}}forEach(_unit weaponsTurret _turretPath)}}forEach _turrets};_weaponsToFire};